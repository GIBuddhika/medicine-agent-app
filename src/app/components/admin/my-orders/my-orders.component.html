<div class="wrapper">
    <div class="container cart">
        <div class="container">
            <div class="row">
                <div class="col-sm-12">
                    <form [formGroup]="orderSearchForm">
                        <div class="row">
                            <div class="col-sm-4 col-xs-12" *ngIf="accountType != isAccountTypePersonalOnly">
                                <div class="form-group">
                                    <div class="flex">
                                        <div class="form-check margin-b-0">
                                            <label class="form-check-label">
                                                <input class="form-check-input" type="checkbox" value="true"
                                                    [(ngModel)]="isPersonalOrdersOnly"
                                                    [ngModelOptions]="{standalone: true}"
                                                    (change)="fetchPersonalItems()">
                                                Personal orders only
                                                <span class="form-check-sign"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-4 col-xs-12 shop" [ngClass]="{'disabled':isPersonalOrdersOnly}"
                                *ngIf="accountType != isAccountTypePersonalOnly">
                                <label>Shop</label>
                                <select class="browser-default custom-select form-control" formControlName="shopId"
                                    (change)="onShopChange()" id="shopId">
                                    <option selected value="">All shops</option>
                                    <option *ngFor="let shop of shops" value="{{shop.id}}">
                                        {{shop.name|titlecase}},&nbsp;{{shop.city.name}}
                                    </option>
                                </select>
                            </div>
                            <div class="col-sm-4 col-xs-12">
                                <label>Status</label>
                                <select class="browser-default custom-select form-control" formControlName="status"
                                    id="status">
                                    <option value="not-collected">Not collected</option>
                                    <!-- change defalt selected item later -->
                                    <option [selected]="true" value="collected">Collected</option>
                                </select>
                            </div>
                            <div class="col-sm-4 col-xs-12">
                                <label>Date</label>
                                <div class="input-group">
                                    <input class="form-control" placeholder="yyyy-mm-dd" name="dp" [(ngModel)]="date"
                                        ngbDatepicker #d="ngbDatepicker" [ngModelOptions]="{standalone: true}" />
                                    <button class="btn btn-outline-secondary bi bi-calendar3" (click)="d.toggle()"
                                        type="button"></button>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-sm-4 col-xs-12">
                                <label>Order No.</label>
                                <input class=" form-control" type="text" placeholder="Order No"
                                    formControlName="orderNo">
                            </div>
                            <div class="col-sm-4 col-xs-12"
                                [title]="isProductsListDisabled?'Select a shop to show the products':''">
                                <label>
                                    Product
                                    {{
                                    (isProductsListDisabled && !isPersonalOrdersOnly)
                                    ?'(Select a shop to show the products)'
                                    :''
                                    }}
                                </label>
                                <ng-select class="custom form-control browser-default" [items]="products"
                                    [disabled]="isProductsListDisabled && !isPersonalOrdersOnly" bindLabel="name"
                                    bindValue="id" [(ngModel)]="selectedProduct" [ngModelOptions]="{standalone: true}">
                                </ng-select>
                            </div>
                            <div class="col-sm-4 col-xs-12">
                                <label>Customer phone (9 digits)</label>
                                <input class=" form-control" type="text" placeholder="702223344"
                                    formControlName="phone">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <br>
        <div style="display: block;">
            <div class="row">
                <div class="col-sm-12">
                    <button type="button" class="btn btn-warning btn float-right" (click)="filterOrders()"
                        replaceText="Searching" [spinnerButton]="isSearching">Search</button>
                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-md-12" *ngIf="orderItems.users.length>0">
                <div class="card-normal no-decorations mb-40" *ngFor="let user of orderItems.users">
                    <div class="row">
                        <div class="col-md-6">
                            <h4><b>{{user.name}}</b></h4>
                        </div>
                        <div class="col-md-6 text-right">
                            <a href="tel:{{user.phone}}">{{user.phone}}</a>
                            <p>{{user.address}}</p>
                            <a href="https://www.google.com/maps/dir/{{user.latitude}},{{user.longitude}}"
                                target="_blank">
                                <button type="button" class="btn btn-outline-info btn-sm">
                                    Open item location in Google map
                                </button>
                            </a>
                        </div>
                    </div>
                    <br>
                    <div class="card-normal no-decorations" *ngFor="let orderItem of user.orderItems">
                        <div class="row product">
                            <div class="col-md-3">
                                <div style="background-image: url('{{imagePath + orderItem.location}}');
                            background-repeat: no-repeat;
                            background-position: center;
                            background-size: cover;
                            width: 100%;height: 100px;">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <p>Quantity: {{orderItem.quantity}}</p>
                                <p *ngIf="orderItem.duration">Duration: {{orderItem.duration}} month(s)</p>
                                <p class="price">{{orderItem.quantity * orderItem.price| currency:"Rs. "}}</p>
                            </div>
                            <div class="col-md-4">
                                <p>Order No: {{orderItem.order_id}}</p>
                                <span>Order date: {{orderItem.order_created_at | date: 'yyyy/MM/dd hh.mm a' }}</span>
                            </div>
                            <div class="col-md-3">
                                <p>Shop: {{orderItem.shop_name_address}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12" *ngIf="orderItems.users.length==0">
                <h3>No Orders Found.</h3>
            </div>
        </div>
    </div>
</div>